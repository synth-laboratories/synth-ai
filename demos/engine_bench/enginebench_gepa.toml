# GEPA Configuration for EngineBench (SDK prompt_learning format)

[prompt_learning]
task_app_url = "http://localhost:8020"
env_name = "engine_bench"
algorithm = "gepa"

[prompt_learning.initial_prompt]
id = "enginebench_coding"
name = "EngineBench Coding Task"

[[prompt_learning.initial_prompt.messages]]
role = "user"
pattern = "{task_description}"
order = 0

[prompt_learning.initial_prompt.wildcards]
task_description = "REQUIRED"

[prompt_learning.gepa]
env_name = "engine_bench"

[prompt_learning.gepa.evaluation]
seeds = [
    0,   # df-001-ampharos - Stage 2, Poke-Body
    2,   # df-003-heracross - Basic, Poke-Body (damage reduction)
    7,   # df-008-ninetales - Poke-Power (search deck)
    8,   # df-009-pinsir - Poke-Body (armor effect)
    9,   # df-010-snorlax - Dual Poke-Power + Poke-Body
    16,  # df-017-jynx - Poke-Body (retreat cost modification)
    22,  # df-023-tropius - Simple attacks
    29,  # df-030-flaaffy - Stage 1, mixed effects
    35,  # Basic with simple mechanics
    42,  # Stage 2 evolved Pokemon
    51,  # Attack modifier mechanics
    68,  # Complex Poke-Power
    77,  # Damage calculation modifier
    88,  # Multi-type Pokemon
    99,  # Evolution chain card
]
validation_seeds = [0, 9, 22, 42, 77]
validation_pool = "train"
validation_top_k = 5

[prompt_learning.gepa.mutation]
rate = 0.5

[prompt_learning.gepa.population]
initial_size = 8
num_generations = 5
children_per_generation = 8
crossover_rate = 0.5
selection_pressure = 1.0

[prompt_learning.gepa.archive]
pareto_set_size = 5

[prompt_learning.gepa.rollout]
budget = 200
max_concurrent = 6
minibatch_size = 6

[prompt_learning.gepa.proposer]
model = "claude-opus-4"

[prompt_learning.policy]
model = "gpt-4.1-mini"
provider = "openai"
inference_mode = "synth_hosted"

[prompt_learning.policy.context_override]
system_prompt = """You are an expert Rust developer implementing Pokemon TCG cards.

Your task: Implement card effects by editing Rust files with stub functions marked with TODO comments.

Key patterns:
- Use `def_id_matches(&card.def_id, "DF", NUMBER)` or `def_id_matches(&card.def_id, "HP", NUMBER)` to identify cards
- Implement attack modifiers in the `attack_override` function
- Implement Poke-Powers/Bodies in the `power_effect` function
- Use `game.queue_prompt()` for user choices
- Return `AttackOverrides::default()` if card doesn't apply

Output requirements:
1. ACTUALLY EDIT files - replace TODO stubs with working code
2. Make sure code compiles (`cargo check`)
3. Make sure tests pass (`cargo test`)"""
