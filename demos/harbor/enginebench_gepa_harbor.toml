# GEPA via Harbor - EngineBench Optimization
# Uses Harbor hosted sandboxes for rollout execution

[prompt_learning]
task_app_url = "https://api-dev.usesynth.ai/api/harbor"
task_app_type = "harbor"
env_name = "engine_bench"
algorithm = "gepa"

# Harbor deployment configuration
[prompt_learning.harbor]
deployment_id = "5dabf170-046d-4e36-8637-7556981fdab6"

[prompt_learning.initial_prompt]
id = "enginebench_coding_harbor"
name = "EngineBench Coding Task (Harbor)"

[[prompt_learning.initial_prompt.messages]]
role = "user"
pattern = "{task_description}"
order = 0

[prompt_learning.initial_prompt.wildcards]
task_description = "REQUIRED"

[prompt_learning.gepa]
env_name = "engine_bench"

[prompt_learning.gepa.evaluation]
seeds = [0, 1, 2, 3, 4]  # Quick demo with 5 seeds
validation_seeds = [0, 2]
validation_pool = "train"
validation_top_k = 2

[prompt_learning.gepa.mutation]
rate = 0.5

[prompt_learning.gepa.population]
initial_size = 2
num_generations = 2
children_per_generation = 2
crossover_rate = 0.5
selection_pressure = 1.0

[prompt_learning.gepa.archive]
pareto_set_size = 5

[prompt_learning.gepa.rollout]
budget = 20
max_concurrent = 5
minibatch_size = 2

[prompt_learning.gepa.token]
counting_model = "gpt-4"
enforce_pattern_limit = false

[prompt_learning.gepa.proposer]
model = "claude-sonnet-4"

[prompt_learning.policy]
model = "gpt-4o-mini"
provider = "openai"
inference_mode = "synth_hosted"

[prompt_learning.policy.context_override]
system_prompt = """You are an expert Rust developer implementing Pokemon TCG cards.

Your task: Implement card effects by editing Rust files with stub functions marked with TODO comments.

Key patterns:
- Use `def_id_matches(&card.def_id, "DF", NUMBER)` to identify cards
- Implement attack modifiers in the `attack_override` function
- Use `game.queue_prompt()` for user choices
- Return `AttackOverrides::default()` if card doesn't apply

Output requirements:
1. EDIT files - replace TODO stubs with working code
2. Make code compile (`cargo check`)
3. Make tests pass (`cargo test`)"""
