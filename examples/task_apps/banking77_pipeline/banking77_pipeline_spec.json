{
  "metadata": {
    "id": "spec.banking77_pipeline.v1",
    "title": "Banking77 Two-Stage Classification Pipeline Specification",
    "version": "1.0.0",
    "owner": "prompt-learning@synth.ai",
    "created_at": "2025-11-06",
    "updated_at": "2025-11-06",
    "imports": [],
    "scope": "banking-intent-classification-pipeline",
    "description": "System specification for the Banking77 two-stage pipeline: query analyzer determines complexity, then classifier assigns one of 77 intent categories. This spec covers BOTH stages as a unified system."
  },
  "principles": [
    {
      "id": "P-staged-reasoning",
      "text": "Use the query analyzer stage to assess complexity before classification to improve accuracy on ambiguous queries.",
      "rationale": "Two-stage processing allows the system to adapt its approach based on query difficulty, improving overall performance."
    },
    {
      "id": "P-clarity",
      "text": "Prioritize immediate-action intents over informational queries when multiple interpretations are possible.",
      "rationale": "Customers with urgent issues (lost cards, failed transactions) need immediate assistance."
    },
    {
      "id": "P-specificity",
      "text": "Choose more specific intent categories over general ones when both are plausible.",
      "rationale": "Specific categories enable more targeted responses and better customer experience."
    },
    {
      "id": "P-consistency",
      "text": "Maintain consistent terminology and category assignment across both pipeline stages.",
      "rationale": "The analyzer and classifier must work together seamlessly for coherent results."
    }
  ],
  "rules": [
    {
      "id": "R-analyzer-complexity",
      "title": "Query analyzer complexity assessment",
      "rationale": "The first stage must accurately assess query complexity to guide the classifier.",
      "priority": 9,
      "constraints": {
        "must": [
          "Classify queries as 'simple' when intent is immediately obvious from keywords",
          "Classify queries as 'complex' when multiple intents are plausible or disambiguation is needed",
          "Consider urgency signals, ambiguous terminology, and multiple topics as complexity indicators"
        ],
        "must_not": [
          "Over-simplify queries that require careful disambiguation",
          "Over-complicate straightforward queries with clear intent keywords"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "I am still waiting on my card?",
          "response": "simple",
          "description": "Clear card arrival query, single intent"
        },
        {
          "kind": "good",
          "prompt": "My card was declined but I also haven't received my new card yet",
          "response": "complex",
          "description": "Multiple intents (declined payment + card arrival) requiring disambiguation"
        }
      ]
    },
    {
      "id": "R-card-disambiguation",
      "title": "Disambiguate card arrival vs. card payment issues",
      "rationale": "Queries mentioning 'card' can refer to physical card delivery or payment problems. Keywords provide disambiguation.",
      "priority": 10,
      "constraints": {
        "must": [
          "Classify as 'lost_or_stolen_card' or 'card_not_working' if payment-related keywords are present (charge, declined, transaction, payment)",
          "Classify as 'card_arrival' or 'card_delivery_estimate' if delivery-related keywords are present (waiting, hasn't arrived, shipped, tracking)"
        ],
        "must_not": [
          "Assume 'card' always refers to physical delivery",
          "Ignore urgency indicators like 'immediately', 'ASAP', 'urgent'"
        ],
        "should": [
          "Consider the query_analyzer's complexity assessment when disambiguating"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "My card was declined at the store",
          "response": "declined_card_payment",
          "description": "Payment keyword (declined) indicates payment issue, not delivery"
        },
        {
          "kind": "good",
          "prompt": "I am still waiting on my card",
          "response": "card_arrival",
          "description": "Delivery keyword (waiting) indicates delivery issue"
        },
        {
          "kind": "bad",
          "prompt": "My card isn't working",
          "response": "card_arrival",
          "description": "WRONG: 'isn't working' suggests payment issue, should be card_not_working"
        }
      ]
    },
    {
      "id": "R-balance-transfer",
      "title": "Balance not updated scenarios",
      "rationale": "Balance queries require disambiguation between bank transfers vs. cheque/cash deposits.",
      "priority": 9,
      "constraints": {
        "must": [
          "Classify as 'balance_not_updated_after_bank_transfer' when both 'balance' and 'transfer' keywords appear",
          "Classify as 'balance_not_updated_after_cheque_or_cash_deposit' when balance query mentions cheque, cash, or deposit"
        ],
        "should": [
          "Look for payment method indicators (wire, ACH, deposit, cheque, cash)",
          "Treat as complex in analyzer if both methods are mentioned"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "My balance is still wrong after I made a transfer",
          "response": "balance_not_updated_after_bank_transfer",
          "description": "Both balance and transfer present"
        },
        {
          "kind": "good",
          "prompt": "I deposited cash but my balance hasn't changed",
          "response": "balance_not_updated_after_cheque_or_cash_deposit",
          "description": "Cash deposit mentioned"
        }
      ]
    },
    {
      "id": "R-urgency-signals",
      "title": "Handle urgency signals across pipeline",
      "rationale": "Urgent queries (lost cards, fraud) require immediate categorization at both stages.",
      "priority": 10,
      "constraints": {
        "must": [
          "Mark as complex in analyzer when urgency keywords appear",
          "Prioritize lost_or_stolen_card when urgency keywords appear with card mentions",
          "Prioritize compromised_card when fraud or security keywords appear"
        ],
        "should": [
          "Recognize urgency indicators: immediately, ASAP, urgent, emergency, help, stolen, lost, fraud",
          "Fast-track urgent queries through both stages with consistent treatment"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "URGENT: My card was stolen",
          "response": "lost_or_stolen_card",
          "description": "Urgency + stolen keyword, analyzer marks complex, classifier prioritizes security"
        },
        {
          "kind": "good",
          "prompt": "I think someone is using my card",
          "response": "compromised_card",
          "description": "Security/fraud concern"
        }
      ]
    },
    {
      "id": "R-failed-transactions",
      "title": "Transaction failure disambiguation",
      "rationale": "Failed transactions can be transfers, card payments, or other payment types.",
      "priority": 8,
      "constraints": {
        "must": [
          "Classify as 'declined_transfer' when transfer keyword is present with failure indicator",
          "Classify as 'declined_card_payment' when card payment keyword is present with failure indicator",
          "Classify as 'declined_cash_withdrawal' when ATM/cash withdrawal mentioned with failure"
        ],
        "should": [
          "Look for failure keywords: declined, failed, rejected, didn't work, couldn't complete",
          "Analyzer should flag multi-failure queries (e.g., 'transfer failed and card declined') as complex"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "My transfer didn't work",
          "response": "declined_transfer",
          "description": "Transfer + failure indicator"
        },
        {
          "kind": "good",
          "prompt": "My card was declined at the store",
          "response": "declined_card_payment",
          "description": "Card payment + declined"
        }
      ]
    },
    {
      "id": "R-stage-coordination",
      "title": "Coordinate information between stages",
      "rationale": "The classifier should leverage the analyzer's complexity assessment.",
      "priority": 8,
      "constraints": {
        "must": [
          "Classifier should apply more careful disambiguation for queries marked as complex",
          "Classifier should use simpler keyword matching for queries marked as simple"
        ],
        "should": [
          "Pass complexity information from analyzer to classifier via pipeline context",
          "Use consistent terminology across both stages"
        ],
        "must_not": [
          "Let the classifier contradict the analyzer's complexity assessment without clear evidence"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "Query marked complex by analyzer: 'Card issues and balance problem'",
          "response": "Classifier carefully evaluates both card and balance intents, prioritizes based on urgency",
          "description": "Proper coordination between stages"
        }
      ]
    },
    {
      "id": "R-atm-operations",
      "title": "ATM-related queries",
      "rationale": "ATM queries can involve fees, support, or withdrawal issues.",
      "priority": 7,
      "constraints": {
        "must": [
          "Classify as 'cash_withdrawal_charge' when fees are mentioned",
          "Classify as 'atm_support' when technical issues are described"
        ],
        "should": [
          "Look for fee-related keywords (charge, fee, cost) vs. technical keywords (not working, declined, error)"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "Why was I charged for getting cash?",
          "response": "cash_withdrawal_charge",
          "description": "Fee-related query"
        },
        {
          "kind": "good",
          "prompt": "The ATM didn't give me my money",
          "response": "atm_support",
          "description": "Technical issue with ATM"
        }
      ]
    },
    {
      "id": "R-top-up-methods",
      "title": "Top-up method disambiguation",
      "rationale": "Top-up queries vary by payment method (card, cash, cheque, bank transfer).",
      "priority": 7,
      "constraints": {
        "must": [
          "Classify as 'top_up_by_cash_or_cheque' when cash or cheque is mentioned",
          "Classify as 'top_up_by_card_charge' when card payment is mentioned",
          "Classify as 'top_up_by_bank_transfer_charge' when bank transfer is mentioned"
        ]
      },
      "examples": [
        {
          "kind": "good",
          "prompt": "Can I top up with cash?",
          "response": "top_up_by_cash_or_cheque",
          "description": "Cash method specified"
        },
        {
          "kind": "good",
          "prompt": "How do I add money via bank transfer?",
          "response": "top_up_by_bank_transfer_charge",
          "description": "Bank transfer method specified"
        }
      ]
    }
  ],
  "interfaces": {
    "io_modes": ["pipeline", "tool_calling"],
    "capabilities": ["complexity_analysis", "intent_classification"],
    "constraints": {
      "output_format": "two_stage_pipeline",
      "stage_1": "query_analyzer (complexity: simple|complex)",
      "stage_2": "classifier (tool_call: banking77_classify)",
      "num_intents": 77
    }
  },
  "glossary": [
    {
      "term": "query_analyzer",
      "definition": "First stage of the pipeline that assesses query complexity",
      "aliases": ["analyzer", "complexity_assessor", "stage_1"]
    },
    {
      "term": "classifier",
      "definition": "Second stage of the pipeline that assigns final intent category",
      "aliases": ["intent_classifier", "categorizer", "stage_2"]
    },
    {
      "term": "intent",
      "definition": "The underlying goal or purpose of a customer query",
      "aliases": ["category", "classification"]
    },
    {
      "term": "disambiguate",
      "definition": "To distinguish between multiple plausible interpretations using contextual keywords",
      "aliases": ["clarify", "distinguish"]
    },
    {
      "term": "urgency indicator",
      "definition": "Keywords signaling time-sensitive issues requiring immediate action",
      "aliases": ["urgent keyword", "priority signal"]
    },
    {
      "term": "pipeline coordination",
      "definition": "Information flow and consistency between the analyzer and classifier stages",
      "aliases": ["stage coordination", "inter-stage communication"]
    }
  ],
  "changelog": [
    {
      "version": "1.0.0",
      "date": "2025-11-06",
      "changes": [
        "Initial pipeline-level specification with 8 core rules",
        "Added principles for staged reasoning, clarity, specificity, and consistency",
        "Defined rules for analyzer complexity assessment and classifier disambiguation",
        "Included stage coordination rule (R-stage-coordination)",
        "Covers full two-stage pipeline as unified system"
      ]
    }
  ]
}

